<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>CO2-Daten Portal</title>
    <h:outputStylesheet library="css" name="styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="text/javascript">
        function handleLoginComplete(xhr, status, args) {
            if (args && args.validationFailed) {
                PF('messages').show();
            }
        }
        
        function handleDiagnosticComplete(xhr, status, args) {
            if (args && args.validationFailed) {
                PF('messages').show();
            }
        }
    </script>
</h:head>
<h:body>
    <h:panelGroup rendered="#{facesContext.maximumSeverity.ordinal ge 0}">
        <p:messages id="errorMessages" showDetail="true" closable="true" />
    </h:panelGroup>
    
    <h1 class="page-title">CO2-Daten Portal</h1>
    
    <div class="clearfix">
        <h:panelGroup layout="block" styleClass="login-panel">
            <h:form id="loginForm">
                <p:panel header="Login">
                    <p:messages id="messages" showDetail="true" closable="true" />
                    
                    <div class="ui-fluid">
                        <div class="p-field">
                            <p:outputLabel for="username" value="Benutzer:" />
                            <p:inputText id="username" 
                                       value="#{mainController.userInput}" 
                                       required="true" 
                                       requiredMessage="Bitte geben Sie einen Benutzernamen ein"
                                       placeholder="Benutzername eingeben"/>
                            <p:message for="username" />
                        </div>

                        <div class="p-field">
                            <p:outputLabel for="password" value="Passwort:" />
                            <p:password id="password" 
                                      value="#{mainController.passwordInput}" 
                                      required="true" 
                                      requiredMessage="Bitte geben Sie ein Passwort ein"
                                      placeholder="Passwort eingeben"/>
                            <p:message for="password" />
                        </div>
                    </div>

                    <p:commandButton value="Einloggen"
                                   action="#{mainController.login}"
                                   update="@form messages"
                                   process="@form"
                                   styleClass="ui-button-primary"
                                   style="width: 100%; margin-top: 10px;"/>

                    <p:commandButton value="Login-Diagnose"
                                   action="#{mainController.diagnoseLogin}"
                                   update="@form messages"
                                   process="@form"
                                   styleClass="ui-button-secondary"
                                   style="width: 100%; margin-top: 10px;"/>
                </p:panel>
            </h:form>
        </h:panelGroup>

        <h:panelGroup layout="block" styleClass="data-panel">
            <p:panel header="Aktuelle CO2-Daten">
                <h:form id="co2Form">
                    <p:selectOneMenu value="#{shop.selectedCountry}">
                        <f:selectItem itemLabel="-- Land auswählen --" itemValue="" />
                        <f:selectItems value="#{shop.countries}" />
                        <p:ajax listener="#{shop.onCountryChange}" update="co2output" />
                    </p:selectOneMenu>

                    <h:panelGroup id="co2output" styleClass="latest-data">
                        <h:panelGroup rendered="#{not empty shop.currentArtikel}">
                            <h:panelGroup layout="block">
                                <h:outputText value="#{shop.currentArtikel.land}" styleClass="heading-text" />
                                <h:panelGroup layout="block" styleClass="data-value">
                                    <h:outputText value="CO2-Ausstoß: #{shop.currentArtikel.co2Ausstoss} #{shop.currentArtikel.einheit}" />
                                </h:panelGroup>
                                <h:panelGroup layout="block" styleClass="data-date">
                                    <h:outputText value="Stand: #{shop.currentArtikel.jahr}" />
                                    <h:outputText value=" (Aktualisiert am: #{shop.currentArtikel.erstelltAm})">
                                        <f:convertDateTime pattern="dd.MM.yyyy" />
                                    </h:outputText>
                                </h:panelGroup>
                                <h:panelGroup layout="block" styleClass="source-text">
                                    <h:outputText value="Quelle: #{shop.currentArtikel.beschreibung}" />
                                </h:panelGroup>
                            </h:panelGroup>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{empty shop.currentArtikel}">
                            <h:outputText value="Bitte wählen Sie ein Land aus, um die aktuellen CO2-Daten anzuzeigen." 
                                        style="color: #666; display: block; text-align: center; padding: 20px;"/>
                        </h:panelGroup>
                    </h:panelGroup>
                </h:form>
            </p:panel>
        </h:panelGroup>
    </div>
</h:body>
</html>
